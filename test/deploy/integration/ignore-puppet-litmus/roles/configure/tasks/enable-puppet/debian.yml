---
- name: Install prereqs for ansible.builtin.apt module
  ansible.builtin.apt:
    name:
      - xz-utils

- name: Add puppet-release package repository
  ansible.builtin.apt:
    deb: https://apt.puppet.com/puppet-release-focal.deb

- name: Update apt
  shell: apt update -y
  become: yes

- name: Install puppet-agent
  ansible.builtin.apt:
    name:
      - net-tools
      - puppet-agent
    state: present

- name: Symlink puppet
  shell: ln -s /opt/puppetlabs/bin/puppet /usr/bin/puppet
  ignore_errors: true

- name: Add puppet-tools package repository (PDK)
  ansible.builtin.apt:
    deb: https://apt.puppet.com/puppet-tools-release-focal.deb

- name: Install pdk
  ansible.builtin.apt:
    name:
      - pdk
    state: present
