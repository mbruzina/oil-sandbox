---
- debug:
    msg: Install go

- name: install go
  shell: sudo yum install go -y
  become: true

- name: Create templates directory
  file:
    path: ~/templates
    state: directory

- name: Copy files to templates directory
  synchronize:
      src: "{{ item }}"
      dest: ~/templates/
      mode: push
  with_fileglob:
    - "../../../../templates/*"
  become: true

- name: Run go mod init
  shell: cd /home/ec2-user/templates && go mod init home/ec2-user/templates
  become: true

- name: Run go mod tidy
  shell: cd /home/ec2-user/templates && go mod tidy
  become: true

- name: Change Permissions for /home/ec2-user/templates
  shell: chown -R ec2-user:ec2-user /home/ec2-user/templates/ && chmod -R 755 /home/ec2-user/templates
  become: true
  
# Use the below command to run it locally
# - name: Run sample go application
#   ansible.builtin.shell: cd ~/templates && go build . && nohup ./gosampleapp &
  


